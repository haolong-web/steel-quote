<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>智能钢格栅报价工具（含税可选）</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<style>
  body{margin:0;padding:10px;font-family:Arial;background:#f7f7f7;}
  h1{text-align:center;font-size:20px;margin-bottom:10px;}
  .card{background:#fff;padding:10px;margin-bottom:12px;border-radius:8px;box-shadow:0 0 4px rgba(0,0,0,0.1);}
  label{font-weight:bold;display:block;margin-bottom:4px;font-size:14px;}
  input,select{width:100%;padding:8px;margin-bottom:8px;font-size:16px;border:1px solid #ccc;border-radius:4px;}
  .checkbox{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
  button{width:100%;padding:12px;font-size:18px;border:none;border-radius:6px;background:#28a745;color:#fff;}
  button:active{opacity:.85;}
  .result{margin-top:12px;background:#fefefe;border:1px solid #ddd;border-radius:6px;padding:10px;font-size:14px;}
  table{width:100%;border-collapse:collapse;}
  th,td{border:1px solid #ccc;padding:6px;text-align:right;}
  th:first-child,td:first-child{text-align:left;}
  .tot{font-weight:bold;color:#28a745;}
</style>
</head>
<body>
<h1>钢格栅智能报价</h1>

<div class="card">
  <label>型号选择</label>
  <select id="model">
    <option value="custom">自定义</option>
    <option value="G253/30/100">G253/30/100 (25×3 扁钢)</option>
    <option value="G325/30/100" selected>G325/30/100 (32×5 扁钢)</option>
    <option value="G405/30/100">G405/30/100 (40×5 扁钢)</option>
  </select>
</div>

<div class="card">
  <label>扁钢宽(mm)</label><input id="flatWidth" type="number" value="32">
  <label>扁钢厚(mm)</label><input id="flatThk" type="number" value="5">
  <label>扁钢间距(mm)</label><input id="flatPitch" type="number" value="30">
  <label>麻花钢直径(mm)</label><input id="twistDia" type="number" value="6">
  <label>麻花钢间距(mm)</label><input id="twistPitch" type="number" value="100">
  <label>板宽(mm)</label><input id="panelWidth" type="number" value="1000">
  <label>板长(mm)</label><input id="panelLen" type="number" value="1000">
  <label>数量(片)</label><input id="qty" type="number" value="1">
</div>

<div class="card">
  <label>扁钢单价(元/吨)</label><input id="flatPrice" type="number" value="4500">
  <label>麻花钢单价(元/吨)</label><input id="twistPrice" type="number" value="4800">
  <label>焊工费(元/片)</label><input id="weldFee" type="number" value="15">
  <label>镀锌费(元/吨)</label><input id="galvFee" type="number" value="600">
  <label>运费(总额元)</label><input id="freightFee" type="number" value="200">
</div>

<div class="card">
  <label>利润率(%)</label><input id="profitRate" type="number" value="15">
  <div class="checkbox">
    <input type="checkbox" id="addTax" checked>
    <label for="addTax" style="font-weight:normal;">包含税费</label>
  </div>
  <label>税率(%)</label><input id="taxRate" type="number" value="13">
</div>

<div class="card">
  <button onclick="calc()">计算报价</button>
  <div id="result" class="result" style="display:none;"></div>
</div>

<script>
const MODEL_PRESETS = {
  "G253/30/100":{flatWidth:25,flatThk:3,flatPitch:30,twistDia:6,twistPitch:100},
  "G325/30/100":{flatWidth:32,flatThk:5,flatPitch:30,twistDia:6,twistPitch:100},
  "G405/30/100":{flatWidth:40,flatThk:5,flatPitch:30,twistDia:6,twistPitch:100}
};

document.getElementById('model').addEventListener('change',()=>{
  let m=document.getElementById('model').value;
  if(MODEL_PRESETS[m]){
    let p=MODEL_PRESETS[m];
    document.getElementById('flatWidth').value=p.flatWidth;
    document.getElementById('flatThk').value=p.flatThk;
    document.getElementById('flatPitch').value=p.flatPitch;
    document.getElementById('twistDia').value=p.twistDia;
    document.getElementById('twistPitch').value=p.twistPitch;
  }
});

function num(id){return parseFloat(document.getElementById(id).value)||0;}

function calc(){
  let fw=num('flatWidth'), ft=num('flatThk'), fpitch=num('flatPitch');
  let td=num('twistDia'), tpitch=num('twistPitch');
  let pw=num('panelWidth'), pl=num('panelLen'), qty=num('qty');
  let flatPrice=num('flatPrice'), twistPrice=num('twistPrice');
  let weldFee=num('weldFee'), galvFee=num('galvFee'), freight=num('freightFee');
  let profitRate=num('profitRate')/100, taxRate=num('taxRate')/100;
  let addTax=document.getElementById('addTax').checked;

  let flatCount=Math.floor(pw/fpitch)+1;
  let twistCount=Math.floor(pl/tpitch)+1;

  function steelWeight(area,len){return area*len*7.85e-6;} //kg
  let flatArea=fw*ft;
  let twistArea=Math.PI*Math.pow(td/2,2);

  let flatOne=steelWeight(flatArea,pl);
  let twistOne=steelWeight(twistArea,pw);

  let flatTotal=(flatOne*flatCount)*qty/1000; //吨
  let twistTotal=(twistOne*twistCount)*qty/1000; //吨
  let totalTon=flatTotal+twistTotal;

  let costFlat=flatTotal*flatPrice;
  let costTwist=twistTotal*twistPrice;
  let costGalv=totalTon*galvFee;
  let costWeld=weldFee*qty;

  let subtotal=costFlat+costTwist+costGalv+costWeld+freight;
  let profit=subtotal*profitRate;
  let beforeTax=subtotal+profit;
  let tax=addTax?beforeTax*taxRate:0;
  let total=beforeTax+tax;
  let unit=total/qty;

  document.getElementById('result').style.display='block';
  document.getElementById('result').innerHTML=`
    <table>
      <tr><th>项目</th><th>单片</th><th>合计</th></tr>
      <tr><td>扁钢根数</td><td>${flatCount}</td><td>${flatCount*qty}</td></tr>
      <tr><td>麻花钢根数</td><td>${twistCount}</td><td>${twistCount*qty}</td></tr>
      <tr><td>重量(kg)</td><td>${(totalTon*1000/qty).toFixed(2)}</td><td>${(totalTon*1000).toFixed(2)}</td></tr>
      <tr><td>材料费</td><td>-</td><td>${(costFlat+costTwist).toFixed(2)}</td></tr>
      <tr><td>镀锌费</td><td>-</td><td>${costGalv.toFixed(2)}</td></tr>
      <tr><td>焊工费</td><td>${costWeld/qty}</td><td>${costWeld}</td></tr>
      <tr><td>运费</td><td>-</td><td>${freight}</td></tr>
      <tr><td>利润</td><td>-</td><td>${profit.toFixed(2)}</td></tr>
      ${addTax?`<tr><td>税额</td><td>-</td><td>${tax.toFixed(2)}</td></tr>`:""}
      <tr class="tot"><td>总价(含税)</td><td>${unit.toFixed(2)}</td><td>${total.toFixed(2)}</td></tr>
    </table>`;
}
</script>
</body>
</html>
